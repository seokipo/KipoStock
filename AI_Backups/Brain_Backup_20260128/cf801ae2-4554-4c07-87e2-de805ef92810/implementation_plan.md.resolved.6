# 오류 수정 및 UI 안정화 구현 계획

이 계획은 [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#255-441) 명령어 실행 시 발생하는 런타임 에러를 수정하고, 압정 핀 기능의 사용자 경험을 개선하는 것을 목표로 합니다.

## 제안된 변경 사항

### 1. [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#255-441) 명령어 수정 (에러 수정 및 역순 정렬 추가)
#### [수정] [chat_command.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py)
- **에러 수정**: `bt_data` 로드 로직을 [get_sort_key](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#293-315) 정의보다 위로 이동하여 `NameError`를 원천 봉쇄합니다.
- **역순 정렬**: 명령어 끝에 `-` 기호가 붙은 경우(`today-`, `today/sic-` 등) `reverse=True` 옵션을 적용하도록 수정합니다.
- **처리 순서**: [process_command](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#492-523)에서 하이픈(`-`) 존재 여부를 먼저 파악한 후 [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#255-441) 메서드에 인자로 전달합니다.

### 2. 압정 핀 깜빡임 및 위치 이동 해결
#### [수정] [Kipo_GUI_main.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/Kipo_GUI_main.py)
- **원인 분석**: Qt의 `setWindowFlags`는 윈도우 핸들을 재성성하며, 이 과정에서 윈도우 프레임 계산 차이로 인해 위치가 미세하게 이동하고 화면이 깜빡입니다.
- **해결 방안**: Windows OS 환경임을 고려하여 `ctypes`를 통해 Win32 API(`SetWindowPos`)를 직접 호출합니다.
- **장점**: 윈도우 핸들을 재성성하지 않으므로 깜빡임이 전혀 없고, 위치나 크기가 변하지 않습니다.

### 3. 명령어 정렬 순서 설명
- [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#255-441) 명령어의 각 옵션별 정렬 로직과 우선순위를 사용자에게 명확히 설명합니다.

## 검증 계획

### 수동 검증
- [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#255-441) 명령어를 입력했을 때 에러 없이 매수 시간순으로 정렬되는지 확인합니다.
- 압정 핀 버튼을 클릭할 때 창이 깜빡이거나 사라지지 않고 부드럽게 상태가 변하는지 확인합니다.
