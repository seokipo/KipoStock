# 구현 계획 - 조건식 확장 & 동적 설정 & Today 시간 표시

## 목표 설명
1. **조건식 선택 확장**: GUI에서 조건식을 0~19번(총 20개)까지 선택할 수 있도록 개선합니다.
2. **동적 설정 반영**: 프로그램 실행 중(`START` 상태) 설정을 변경하면 즉시 반영되도록 합니다. 특히 조건식 변경 시 감시 목록을 실시간으로 갱신합니다.
3. **Today 매수 시간**: [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#233-356) 명령어 출력 시 매수 시간을 표시합니다.

## 사용자 검토 필요
> [!NOTE]
> [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#233-356) 명령의 "매수 시간"은 증권사 API([ka10170](file:///d:/Work/Python/AutoBuy/KipoStockNow/acc_diary.py#9-52))가 제공하는 데이터에 의존합니다. 만약 API에서 최초 매수 시간 필드(`fst_buy_tm`)를 제공하지 않는 경우 표시되지 않을 수 있습니다.

## 변경 제안

### 1. 조건식 선택 UI 확장 (20개)
#### [수정] [Kipo_GUI_main.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/Kipo_GUI_main.py)
- [setup_ui](file:///d:/Work/Python/AutoBuy/KipoStockNow/Kipo_GUI_main.py#331-686) 메서드 내 조건식 버튼 생성 루프를 `range(10)` -> `range(20)`으로 변경합니다.
- 레이아웃을 2줄(`GridLayout` 또는 2개의 `HBox`)로 변경하여 배치합니다.
- [on_cond_clicked](file:///d:/Work/Python/AutoBuy/KipoStockNow/Kipo_GUI_main.py#830-836) 등에서 인덱스 처리를 확인합니다 (기존 로직이 `idx` 인자를 받으므로 루프만 늘리면 됨).
- 버튼 클릭 시 `worker.schedule_command('refresh_conditions')`를 호출하여 실시간 반영합니다.

### 2. 동적 설정 (조건식 새로고침)
#### [수정] [rt_search.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/rt_search.py)
- `refresh_conditions(token)` 메서드 추가:
    - [get_setting](file:///d:/Work/Python/AutoBuy/KipoStockNow/get_setting.py#15-30)으로 최신 `search_seq`를 읽어옵니다.
    - `CNSRREQ` 패킷을 전송하여 감시를 등록합니다. (추가 등록 방식)
    
#### [수정] [chat_command.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py)
- `refresh_conditions` 명령어 핸들러 추가 -> `rt_search.refresh_conditions` 호출.

### 3. Today 매수 시간 표시
#### [수정] [chat_command.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py)
- [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#233-356) 메서드:
    - 출력 포맷을 `[{time}] [{cond}] {name}...` 형식으로 변경합니다.
    - `item.get('fst_buy_tm')` 값을 추출하여 `HH:mm:ss` 포맷으로 변환합니다. (API 필드 확인 필요, 없으면 공란)

## 검증 계획
### 수동 검증
1. **UI**: 버튼이 0~19번까지 2줄로 잘 나오는지 확인.
2. **동적 반영**: START 상태에서 조건식을 변경(클릭)하고, 로그에 "조건식 등록 요청"이 뜨는지 확인.
3. **Today**: 매매 내역이 있는 상태에서 [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#233-356) 입력 시 매수 시간이 표시되는지 확인.
