# Trade Data Discrepancy & Reporting (V5.2.6)

HTS 자료와 API 조회 데이터가 일치하지 않는 문제(0원 표시 등)를 해결하고 리포트 정확도를 높입니다.

## 핵심 원인 분석
1. **데이터 병합 로직 오류**: [ka10077](file:///d:/Work/Python/AutoBuy/KipoStockNow/acc_diary.py#54-94)(상세손익)은 '매도'가 발생한 종목만 데이터를 반환합니다. 매수만 하고 보유 중인 종목은 데이터가 없어 0으로 표시되거나 계산 오류가 발생했습니다.
2. **필드 매핑 미비**: [ka10170](file:///d:/Work/Python/AutoBuy/KipoStockNow/acc_diary.py#9-52)과 [ka10077](file:///d:/Work/Python/AutoBuy/KipoStockNow/acc_diary.py#54-94)에서 사용하는 필드명이 일부 상이하여 데이터를 매칭하지 못하는 경우가 있었습니다.
3. **수익금 계산 보정**: `s_amt` 계산 시 수수료와 제세금을 더 정확하게 반영하여 HTS상의 '손익금액'과 일치시키겠습니다.

## Proposed Changes

### [Component] Trade Reporting Layer

#### [MODIFY] [chat_command.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py)
- [today](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#253-432) 메서드에서 [ka10077](file:///d:/Work/Python/AutoBuy/KipoStockNow/acc_diary.py#54-94) 데이터가 없을 경우(미매도 종목) [ka10170](file:///d:/Work/Python/AutoBuy/KipoStockNow/acc_diary.py#9-52)의 기본 데이터를 우선 사용하도록 폴백 로직을 강화합니다.
- 상세 매도 정보(`s_avg`, `s_qty`, `s_amt`) 가공 시 [ka10170](file:///d:/Work/Python/AutoBuy/KipoStockNow/acc_diary.py#9-52)의 당일 매도 수량 및 금액 필드를 적극 활용합니다.
- 손익 계산 시 `s_amt - b_amt - tax` 공식을 정교화합니다.

## Verification Plan

### Manual Verification
- 사용자 업로드 이미지(HTS vs GUI)의 수치(유라클, 유일로보틱스 등)가 동일하게 나오는지 대조 확인.
