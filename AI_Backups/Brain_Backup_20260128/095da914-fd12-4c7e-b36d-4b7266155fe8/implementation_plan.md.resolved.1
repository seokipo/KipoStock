# 시작/중지 명령어 및 UI 동기화 계획

GUI 버튼, CLI(명령창), 텔레그램 등 모든 입력 경로에서 발생하는 시작/중지 동작을 완벽하게 동기화하고, UI 상태(READY, RUNNING, WAITING)가 시스템 상태를 정확히 반영하도록 개선합니다.

## 사용자 검토 필요 사항

> [!IMPORTANT]
> 완벽한 동기화를 위해 텔레그램을 포함한 모든 '시작' 및 '중지' 요청은 GUI의 워커(Worker) 로직을 거치도록 변경됩니다. 이를 통해 어떤 경로로 명령을 내리든 장외 시간 대기(WAITING) 등의 로직이 일관되게 적용됩니다.

## 변경 사항 요약

### [chat_command.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py)
- [ChatCommand](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#29-659) 클래스에 `on_start_request` 및 `on_stop_request` 콜백 속성 추가
- [process_command](file:///d:/Work/Python/AutoBuy/KipoStockNow/chat_command.py#569-659)에서 'start'/'stop' 명령 수신 시, 콜백이 설정되어 있으면 직접 실행 대신 콜백을 호출하도록 수정

### [Kipo_GUI_main.py](file:///d:/Work/Python/AutoBuy/KipoStockNow/Kipo_GUI_main.py)
- `AsyncWorker.run`에서 `on_start_request` 및 `on_stop_request`를 등록하여 GUI의 시작/중지 핸들러([on_start_clicked](file:///d:/Work/Python/AutoBuy/KipoStockNow/Kipo_GUI_main.py#797-820), [on_stop_clicked](file:///d:/Work/Python/AutoBuy/KipoStockNow/Kipo_GUI_main.py#821-827))를 호출하도록 연결
- `AsyncWorker._execute_command`의 'start'/'stop' 로직을 더 견고하게 보완
- [update_status_ui](file:///d:/Work/Python/AutoBuy/KipoStockNow/Kipo_GUI_main.py#866-885)에서 상태에 따라 시작/중지 버튼의 활성화 상태가 정확히 제어되도록 보장

## 검증 계획

### 자동 테스트
- 각 명령 경로(GUI, CLI, 텔레그램)별로 로그를 남겨 경로 추적 및 상태 신호 발생 확인

### 수동 검증
1.  **GUI 버튼 테스트**: 시작/중지 클릭 시 UI 상태 변화 및 엔진 작동 확인
2.  **명령창(CLI) 테스트**: GUI 하단 입력창에 "start"/"stop" 입력 시 버튼 클릭과 동일하게 작동하는지 확인
3.  **텔레그램 테스트**: 스마트폰 텔레그램으로 "start"/"stop" 전송 시 PC의 GUI UI가 즉시 업데이트되는지 확인
4.  **장외 시간 동기화**: 장종료 후 시작 시 UI가 'WAITING'으로 바뀌는지, 그 상태에서 텔레그램으로 중지 시 'READY'로 돌아오는지 확인
