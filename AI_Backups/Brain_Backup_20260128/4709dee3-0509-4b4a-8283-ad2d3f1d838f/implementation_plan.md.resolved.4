# 세금 데이터 수정 및 정렬 기능 구현 계획 (v4 - Hybrid 방식)

[ka10077](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#60-104) API가 종목코드를 필수로 요구하여 전체 목록이 나오지 않는 문제를 해결하기 위해, 전체 목록 조회가 가능한 [ka10170](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#9-58)과 세부 세금 정보가 있는 [ka10077](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#60-104)을 결합한 Hybrid 방식을 도입합니다.

## 변경 제안 내용

### [chat_command.py](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/chat_command.py)

#### [MODIFY] [today](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/chat_command.py#233-313) 메서드
1.  **전체 목록 확보**: `get_trade_diary` ([ka10170](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#9-58))를 호출하여 오늘 매매한 모든 종목 리스트를 가져옵니다.
2.  **종목별 세금 상세 조회**:
    - 조회된 종목 리스트를 순회하며, 각 종목코드(`stk_cd`)에 대해 `get_realized_detail` ([ka10077](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#60-104))을 추가로 호출합니다.
    - 호출 결과에서 `tdy_trde_cmsn`과 `tdy_trde_tax`를 합산하여 해당 종목의 세금 정보로 저장합니다.
3.  **데이터 통합 및 출력**:
    - [ka10170](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#9-58)의 매수/매도 정보와 [ka10077](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#60-104)의 세금 정보를 병합합니다.
    - 이전과 동일하게 조건식 이름 기준 오름차순 정렬을 수행하여 출력합니다.
4.  **최적화**: 동일 종목에 대해 중복 API 호출을 방지하기 위해 캐싱 또는 Set을 활용합니다.

#### [KEEP] 빌드 자동화
- 수정 완료 후 [build_v4.2.py](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/build_v4.2.py)를 실행하여 새로운 EXE를 생성합니다.

## 검증 계획

### 수동 검증
- [today](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/chat_command.py#233-313) 명령어 실행 시:
    - **전체 종목**이 누락 없이 다 나오는지 확인.
    - 각 종목 옆에 **세금** 수치가 0이 아닌 실제 값으로 표시되는지 확인.
    - 정렬 상태 확인.
- API 호출 누적에 따른 지연 시간이 허용 가능한 수준(수 초 내외)인지 확인.
