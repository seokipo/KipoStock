# 세금 데이터 수정 및 정렬 기능 구현 계획 (v3)

사용자가 제공한 API 정보(`ka10077`)를 분석한 결과, 기존 [ka10170](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#9-58) API는 개별 종목의 세금 정보를 제공하지 않는 것으로 파악되었습니다. 따라서 세금 및 수수료 정보가 포함된 `ka10077` API를 새로 도입하여 [today](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/chat_command.py#233-326) 명령어를 개선합니다.

## 변경 제안 내용

### [acc_diary.py](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py)

#### [NEW] `fn_ka10077` 함수 추가
- **기능**: 당일실현손익상세를 조회하여 세금(`tdy_trde_tax`) 및 수수료(`tdy_trde_cmsn`) 정보를 가져옵니다.
- **필드 구성**: `tdy_rlzt_pl_dtl` 리스트를 반환하도록 설계합니다.

### [chat_command.py](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/chat_command.py)

#### [MODIFY] [today](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/chat_command.py#233-326) 메서드
1.  **API 호출 변경**: 기존 `get_trade_diary` ([ka10170](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/acc_diary.py#9-58))를 `get_realized_detail` (`ka10077`)로 변경합니다. (종목코드에 빈 값을 넣어 전체 조회를 시도하거나, 필요한 경우 보강)
2.  **데이터 매핑 수정**: `ka10077` 응답 구조에 맞춰 변수명을 보정합니다.
    - `tax`: `tdy_trde_cmsn` + `tdy_trde_tax`
    - `b_avg`: `buy_uv` (매입단가)
    - `s_avg`: `cntr_pric` (체결가)
    - `pnl`: `tdy_sel_pl` (당일매도손익)

#### [ADD] 빌드 자동화
- [today](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/chat_command.py#233-326) 명령어 수동 호출 후 또는 작업 마무리 단계에서 [build_v4.2.py](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/build_v4.2.py)를 실행하여 항상 최신 EXE를 생성합니다.

## 검증 계획

### 수동 검증
- [today](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/chat_command.py#233-326) 명령어 실행 시 출력되는 표의 "세금" 항목에 실제 금액이 표시되는지 확인합니다.
- 조건식 기준 오름차순 정렬이 유지되는지 확인합니다.
- 빌드된 EXE 파일([dist/KipoStock_V4.2_GOLD.exe](file:///d:/Work/Python/AutoBuy/KipoBuy4.2/dist/KipoStock_V4.2_GOLD.exe))에서 동일하게 동작하는지 확인합니다.
