# Add Search Formula Name to Buy Success Log

The user wants to see which search formula triggered a buy signal in the console log. Currently, the search formula ID (`seq`) is passed to the buy logic, but the name is not displayed in the success log.

## Proposed Changes

### [KipoBuy_Gui](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.ÏïåÎûå/KipoBuy_Gui)

#### [MODIFY] [check_n_buy_1ju.py](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.ÏïåÎûå/KipoBuy_Gui/check_n_buy_1ju.py)
- Update [chk_n_buy](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.%EC%95%8C%EB%9E%8C/KipoBuy_Gui/check_n_buy_1ju.py#74-197) function signature to accept a `seq_name` parameter.
- Update the "Îß§ Ïàò Ï≤¥ Í≤∞ ÏÑ± Í≥µ" log block to include a "üîç Í≤ÄÏÉâ:" line showing the formula name.

#### [MODIFY] [rt_search.py](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.ÏïåÎûå/KipoBuy_Gui/rt_search.py)
- Resolve the formula name from `self.condition_map` using the `seq` (or `origin_seq`) before calling [chk_n_buy](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.%EC%95%8C%EB%9E%8C/KipoBuy_Gui/check_n_buy_1ju.py#74-197).
- Pass the resolved name as the `seq_name` argument to [chk_n_buy](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.%EC%95%8C%EB%9E%8C/KipoBuy_Gui/check_n_buy_1ju.py#74-197).
- **[Bug Fix]** Improved `seq` extraction by checking additional keys (`index`, `condition_seq`).
- **[Bug Fix]** Normalize `data` body before checking fallbacks.
- **[Bug Fix]** Guard `REAL` (real-time transaction) signals to only trigger purchases if the stock's origin search formula is known.

## Verification Plan

### Manual Verification
- Since I cannot run the actual trading system (it requires a live connection and token), I will:
    1.  Syntactically verify the changes.
    2.  Ask the user to run the program and confirm that the search formula name appears in the log when a purchase is made.
    3.  I can also create a small test script to mock the [chk_n_buy](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.%EC%95%8C%EB%9E%8C/KipoBuy_Gui/check_n_buy_1ju.py#74-197) call and verify the log output format.

### Mock Verification Script
- Create a [test_log_output.py](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.%EC%95%8C%EB%9E%8C/KipoBuy_Gui/test_log_output.py) that imports [chk_n_buy](file:///d:/Work/Python/AutoBuy/KipoBuy_Gui_3.%EC%95%8C%EB%9E%8C/KipoBuy_Gui/check_n_buy_1ju.py#74-197) and calls it with dummy data to verify the printed output.
