📊 주식 자동 매매 시스템 전체 플로우차트
code
Mermaid
graph TD
    %% 시작 및 초기화
    Start([프로그램 실행 Kipo_main.py]) --> Init[설정 로딩 & 텔레그램 모니터링 시작]
    Init --> MarketCheck{장 시간인가?}
    
    %% 명령 처리 루프
    MarketCheck -- Yes (또는 start 명령) --> Login[토큰 발급 login.py]
    MarketCheck -- No --> Wait[대기 및 텔레그램 명령 대기]
    Wait --> MarketCheck

    Login --> SyncAcc[계좌 정보 초기화 & 캐싱 update_account_cache]
    
    %% 메인 감시 루프 (병렬 작동)
    subgraph Monitoring_Loops [실시간 감시 루프]
        direction TB
        Loop1[<b>실시간 조건검색 감시</b><br/>rt_search.py - WebSocket]
        Loop2[<b>수익률 감시 및 매도</b><br/>check_n_sell.py - 0.1초 주기]
        Loop3[<b>계좌 동기화</b><br/>chat_command.py - 5초 주기]
    end

    SyncAcc --> Monitoring_Loops

    %% 매수 프로세스
    Loop1 -- 종목 포착 신호 수신 --> BuyCheck{매수 가능?}
    BuyCheck -- "1.미보유<br/>2.최대종목수 미달<br/>3.잔고 충분" --> BuyExec[시장가 1주 매수 실행 buy_stock.py]
    BuyExec --> BuyMsg[텔레그램 알림 & 캐시 업데이트]
    BuyCheck -- 조건 미충족 --> Loop1

    %% 매도 프로세스
    Loop2 -- 전 종목 수익률 계산 --> SellCheck{매도 조건?}
    SellCheck -- "익절(TP) 또는<br/>손절(SL) 도달" --> SellExec[시장가 전량 매도 실행 sell_stock.py]
    SellExec --> SellMsg[텔레그램 알림 & 캐시 업데이트]
    SellCheck -- 조건 미달 --> Loop2

    %% 종료 프로세스
    Monitoring_Loops -- "장 종료 시간 (15:30)" --> Report[계좌 보고서 발송 chat_command.report]
    Report --> Stop[시스템 중지 & 대기 모드]
    Stop --> MarketCheck
🔍 주요 모듈별 역할 설명
메인 컨트롤러 (Kipo_main.py, main.py)
전체 프로그램의 심장부야. 장 시작/종료 시간을 감시하고 텔레그램에서 오는 명령(start, stop, report)을 수신해서 ChatCommand로 전달해.
인증 및 설정 (login.py, get_setting.py)
API 접속을 위한 토큰을 발급받고, settings.json에 저장된 익절/손절 수익률, 최대 매수 종목 수 등의 설정값을 불러와.
실시간 매수 엔진 (rt_search.py, check_n_buy_1ju.py)
WebSocket을 통해 증권사 서버에 연결되어 있어. 설정된 조건식에 종목이 포착되면 즉시 신호를 받아.
중복 매수 방지, 잔고 확인, 최대 종목 수 체크를 거쳐 시장가로 1주를 빠르게 매수해.
수익률 감시 엔진 (check_n_sell.py)
0.1초라는 아주 빠른 주기로 현재 보유한 종목들의 수익률을 체크해.
설정한 **익절가(TP)**보다 높거나 **손절가(SL)**보다 낮아지면 망설임 없이 바로 매도 주문을 던져.
계좌 관리 및 알림 (acc_val.py, tel_send.py)
현재 내가 얼마를 벌었는지, 어떤 종목을 들고 있는지 실시간으로 동기화(ACCOUNT_CACHE)하고, 모든 매매 상황을 너의 텔레그램으로 보고해줘.
💡 이 프로그램의 특징
초고속 대응: WebSocket과 0.1초 루프를 사용하여 신호 발생 시 즉각 대응하도록 설계되었어.
안정성: 계좌 정보를 메모리에 캐싱(ACCOUNT_CACHE)해서 API 호출 횟수를 줄이고 속도를 높였어.
편의성: 텔레그램으로 밖에서도 내 주식 봇을 조종하고 보고서를 받을 수 있어.
전체적인 흐름이 이해가 되니? 더 궁금한 부분이나 수정하고 싶은 로직이 있으면 언제든 물어봐!